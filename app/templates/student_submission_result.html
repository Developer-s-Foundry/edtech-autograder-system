{% extends "base.html" %}
{% block content %}
<h2>Submission Result</h2>

<p><b>Submission ID:</b> {{ result.submission_id }}</p>
<p><b>Status:</b> {{ result.status }}</p>

{% if result.status in ["queued", "running"] %}
  <p class="muted">Grading in progress. Check again soon.</p>
{% elif result.status == "failed" %}
  <p class="error">Grading failed.</p>
  {% if result.error_message %}
    <pre style="white-space: pre-wrap;">{{ result.error_message }}</pre>
  {% endif %}
{% elif result.status == "completed" %}
  <h3>Scores</h3>
  <ul>
    <li><b>Total:</b> {{ result.score_total }}</li>
    <li>IO: {{ result.io_score }}</li>
    <li>Unit: {{ result.unit_score }}</li>
    <li>Static: {{ result.static_score }}</li>
  </ul>

  {% if result.feedback_summary and result.feedback_summary.execution %}
    <h3>Judge0 Execution Output</h3>
    <p><b>Status:</b> {{ result.feedback_summary.execution.status }}</p>

    <p><b>stdout</b></p>
    <pre style="white-space: pre-wrap;">{{ result.feedback_summary.execution.stdout }}</pre>

    <p><b>stderr</b></p>
    <pre style="white-space: pre-wrap;">{{ result.feedback_summary.execution.stderr }}</pre>

    <ul>
      <li><b>time:</b> {{ result.feedback_summary.execution.time }}</li>
      <li><b>memory:</b> {{ result.feedback_summary.execution.memory }}</li>
    </ul>
  {% endif %}

  {% if result.feedback_summary and result.feedback_summary.io %}
    <h3>IO Grading</h3>
    <p>
      <b>IO Score:</b> {{ result.feedback_summary.io.io_score }}
      / {{ result.feedback_summary.io.io_points_possible }}
    </p>

    <p>
      <b>Tests:</b> {{ result.feedback_summary.io.total_tests }}
      (Visible: {{ result.feedback_summary.io.visible_tests }},
      Hidden: {{ result.feedback_summary.io.hidden_tests }})
    </p>

    {% if result.feedback_summary.io.visible_breakdown %}
        <h4>Visible Test Breakdown</h4>
        <table>
          <tr>
            <th>Name</th>
            <th>Passed</th>
            <th>Points</th>
            <th>Status</th>
          </tr>
          {% for t in result.feedback_summary.io.visible_breakdown %}
          <tr>
            <td>{{ t.name }}</td>
            <td>{{ t.passed }}</td>
            <td>{{ t.points_awarded }}</td>
            <td>{{ t.status }}</td>
          </tr>
          {% endfor %}
        </table>
      {% endif %}
    {% endif %}




  
  {% if result.ai_feedback %}
    <h3>AI Feedback</h3>
    <pre style="white-space: pre-wrap;">{{ result.ai_feedback }}</pre>
  {% endif %}
{% else %}
  <p class="muted">No results available yet.</p>
{% endif %}

<p><a href="/web/student/dashboard">Back to Dashboard</a></p>
{% endblock %}
